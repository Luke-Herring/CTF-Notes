# XML external entity (XXE) Injection
XXE injection is a web security vulnerability that allows us to interfere with the processing of XML data. It often allows us to view files on the server filesystem, and to interact with any back-end or external systems that the application itself can access.

Types of XXE attacks
- `XXE to retrieve files` An external entity is containing the contents of a file, and is returned in the response.
- `XXE to perform SSRF` An external entity is defined based on a URL to a back-end system.
- `Blind XXE exfiltrate data out-of-band` sensitive data is transmitted from the application server to a system that the attacker controls.
- `Blind XXE to retrieve data via error messagess` we Can trigger a parsing error message containing sensitive data.

<!-- -->

				XXE to retrieve files
performing an XXE injection attack that retrieves an arbitrary file from the server you need to modify the submitted XML in two ways:

- Introduce (or edit) a `DOCTYPE` element that defines an external entity containing the path to the file.
- Edit a data value in the XML that is returned in the application's response, to make use of the defined external entity.

<!-- -->
Example:

A shopping application checks the stock of products by submitting the following XML
![](XXE1.png)
Their is no defense so we can exploit this by using the following XXE payload
![](XXE2.png)
The payload defines a external entity `&xxe;`. Whose value is in `/etc/passwd` file and uses the entity within `productId` value.This causes the respone to include the contents of `/etc/passwd`
![](XXE3.png)

			XXE via file upload
Sometimes Applications allow users to upload files which are then processed server-side.We send a `SVG` image 


Some file formats use `XML` such as document format `DOCX`  and image format `SVG`



			XXE to perform SSRF

Example:
A shopping application checks the stock of products by submitting the following XML
![](XXE1.png)
Using the payload `<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "https://website.com/"> ]>`we can exploit SSRF
![](XXE4.png)
The external entity will cause the server to make a back-end HTTP request to an internal system within the websites infrastructure.

					XInclude	
Some applications receive client-submitted data, embed it on the server-side into an XML document, and then parse the document

Example:
Packet being sent 
![](XXE5.png)
We don't control the entire XML document and so cannot define or modify a `DOCTYPE` element. However, we can use `XInclude`
![](XXE6.png)
Using the payload  `<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>`